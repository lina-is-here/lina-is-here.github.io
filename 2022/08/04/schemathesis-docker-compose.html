<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>How to use Schemathesis to test Flask API in GitHub Actions | Lina’s random notes</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="How to use Schemathesis to test Flask API in GitHub Actions" />
<meta name="author" content="Angelina Vasileva" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="It’s been definitely more than a year since I first discovered Schemathesis. I ran it against one API and got overwhelming amount of errors. Recently I re-discovered it again and something just clicked! I started to implement fuzzy testing for Ibutsu, which is basically an API written in Flask (python). The application consists of several parts: frontend, backend, worker, postgres and redis. So how can we run it, run fuzzy testing against it and do it all in each PR in GitHub actions?" />
<meta property="og:description" content="It’s been definitely more than a year since I first discovered Schemathesis. I ran it against one API and got overwhelming amount of errors. Recently I re-discovered it again and something just clicked! I started to implement fuzzy testing for Ibutsu, which is basically an API written in Flask (python). The application consists of several parts: frontend, backend, worker, postgres and redis. So how can we run it, run fuzzy testing against it and do it all in each PR in GitHub actions?" />
<link rel="canonical" href="https://notes.lina-is-here.com/2022/08/04/schemathesis-docker-compose.html" />
<meta property="og:url" content="https://notes.lina-is-here.com/2022/08/04/schemathesis-docker-compose.html" />
<meta property="og:site_name" content="Lina’s random notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-08-04T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to use Schemathesis to test Flask API in GitHub Actions" />
<script type="application/ld+json">
{"dateModified":"2022-08-04T00:00:00+00:00","datePublished":"2022-08-04T00:00:00+00:00","description":"It’s been definitely more than a year since I first discovered Schemathesis. I ran it against one API and got overwhelming amount of errors. Recently I re-discovered it again and something just clicked! I started to implement fuzzy testing for Ibutsu, which is basically an API written in Flask (python). The application consists of several parts: frontend, backend, worker, postgres and redis. So how can we run it, run fuzzy testing against it and do it all in each PR in GitHub actions?","mainEntityOfPage":{"@type":"WebPage","@id":"https://notes.lina-is-here.com/2022/08/04/schemathesis-docker-compose.html"},"url":"https://notes.lina-is-here.com/2022/08/04/schemathesis-docker-compose.html","@type":"BlogPosting","author":{"@type":"Person","name":"Angelina Vasileva"},"headline":"How to use Schemathesis to test Flask API in GitHub Actions","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://notes.lina-is-here.com/feed.xml" title="Lina's random notes" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-FBCQY9M93K"></script>
<script>
  window['ga-disable-G-FBCQY9M93K'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FBCQY9M93K');
</script>
<link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
<link rel="manifest" href="/assets/site.webmanifest">
<link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Lina&#39;s random notes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How to use Schemathesis to test Flask API in GitHub Actions</h1>
    <p class="post-meta"><time class="dt-published" datetime="2022-08-04T00:00:00+00:00" itemprop="datePublished">
        Aug 4, 2022
      </time><br>
      <span><a href="/tag/schemathesis.html" rel="tag">schemathesis</a>, <a href="/tag/api.html" rel="tag">api</a>, <a href="/tag/testing.html" rel="tag">testing</a>, <a href="/tag/docker.html" rel="tag">docker</a>, <a href="/tag/docker-compose.html" rel="tag">docker-compose</a>, <a href="/tag/github-actions.html" rel="tag">github actions</a></span>
    </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>It’s been definitely more than a year since I first discovered <a href="https://github.com/schemathesis/schemathesis">Schemathesis</a>.
I ran it against one API and got overwhelming amount of errors. Recently I re-discovered it again and something just clicked!</p>

<p>I started to implement fuzzy testing for <a href="https://github.com/ibutsu/ibutsu-server">Ibutsu</a>, which is basically an API written 
in Flask (python).</p>

<p>The application consists of several parts: frontend, backend, worker, postgres and redis. So how can we run it, run 
fuzzy testing against it and do it all in each PR in GitHub actions?</p>

<!--more-->

<p><strong>1. First, let’s create a docker-compose file with all the necessary components.</strong></p>

<p>For example, it doesn’t make sense to run frontend, because it’s not under test in fuzzy testing.</p>

<p>It’s common, that the docker-compose file already exists, so we just need to make some adjustments in the new file.</p>

<p><strong>2. Next, add the new container to docker-compose.</strong></p>

<p>Fuzzy testing will be performed from this container. I call it <code class="language-plaintext highlighter-rouge">api-tests</code> (see example in 
<a href="https://github.com/ibutsu/ibutsu-server/blob/master/docker-compose-fuzz.yml">Ibutsu repo</a>). 
This container also requires a Dockerfile. The Dockerfile is very simple, it is an image with installed 
schemathesis, and a script that performs the testing, see <a href="https://github.com/ibutsu/ibutsu-server/blob/master/backend/docker/Dockerfile.fuzz_testing">example</a>.</p>

<p>The script should wait for the API to be available (otherwise it will immediately fail and container will exit) and 
run the test command. In the case of Ibutsu, it also acquires a valid token, so it can be later included in all 
requests, see <a href="https://github.com/ibutsu/ibutsu-server/blob/master/backend/docker/start_fuzz_testing.sh">here</a>.</p>

<p><strong>3. Test it locally.</strong></p>

<p>Before proceeding to GitHub actions, let’s verify it works as expected.</p>

<p>Run the new docker-compose configuration locally:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">docker-compose <span class="nt">-f</span> docker-compose-fuzz.yml up</code></pre></figure>

<p>Verify it works as expected and tests are performed.</p>

<p><strong>4. Once it works locally, create a GitHub workflow.</strong></p>

<p>In the root of your project, create a file <code class="language-plaintext highlighter-rouge">.github/workflows/api_test.yaml</code>.</p>

<p>The job does just two things: checks out the repo and then runs docker-compose. You can check how it works in 
<a href="https://github.com/ibutsu/ibutsu-server/blob/master/.github/workflows/api_tests.yaml">Ibutsu</a>.</p>

<p><strong>5. Fix the errors!</strong></p>

<p>Everything should work by now, and the only part that could be “not perfect” is the API under test :D</p>

<p>P.S. I also highly recommend going through <a href="https://schemathesis.readthedocs.io/en/stable/">Schemathesis documentation</a> 
to find all the possible options and enhance your tests and API. Happy fuzzing!</p>

  </div><a class="u-url" href="/2022/08/04/schemathesis-docker-compose.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Angelina Vasileva</li>
          <li><a class="u-email" href="mailto:hi@lina-is-here.com">hi@lina-is-here.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>A place for my notes to share with others.</p>
        <a class="coffee-link" href="https://www.buymeacoffee.com/linaishere">Buy Me A Coffee</a>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/lina-is-here" target="_blank" title="lina-is-here"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/vasilevaangelina" target="_blank" title="vasilevaangelina"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li></ul>
</div>

  </div>

</footer></body>

</html>
